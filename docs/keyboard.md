# Keyboard

## bitsns
`IOCS _BITSNS`を実行してキーの押し下げ状態を表示します。  
マウスのボタンを押すと終了します。

IOCSワークに保存されているキー状態をIOCSコール経由で取得しているだけなので、
実際にキーボードから送られたスキャンコードがそのまま表示されるわけではありません。  
キーボードから送信されるスキャンコードをそのまま得たい場合は、[keyscan](#keyscan)を使用してください。


## jfp_stat
日本語FPの各状態を表示します。  

コマンドライン引数で動作を指定できます。
* `-k` ... 実行時にRETURNキーの入力を待つ。
* 16進数値 ... `DOS _KNJCTRL`の第一引数(日本語FPコール番号)を指定した値との論理和にする。

`DOS _KNJCTRL`の第一引数はロングワードサイズですが、ASK68K version 3.02
では上位ワードを無視しているため`jfp_stat ffff0000`と実行しても状態の取得に成功します。

エコーモードの固定状態については、設定するファンクションコール(56)があるのに取得するコールは
用意されていないため表示できません。


## kbdctrl
キーボード制御コマンドコードをキーボードに送信します。
コードはコマンドライン引数で16進数2桁で指定します(省略時は`$47` = Compactキーボード判別)。


## keyflush
SHIFTキーが押し下げられるまで待機し、キー入力をフラッシュしてから終了します。  
コマンドライン引数でキーフラッシュの方法を指定できます(無指定時は`i`)。
- `i` ... `IOCS _KEYSNS`/`_KEYINP`を使用します。
- `c` ... `DOS _KEYCTRL`を使用します。
- `f` ... `DOS _KFLUSH`を使用します。

`c`は、FEPを組み込んでいると完全に消去できない場合があります。

`f`は「標準入力に対するフラッシュ」なので、`keyflush f < nul`
とすると(NUL デバイスに対してフラッシュを行うため)キーボード入力は消去されません。


## keyscan
キーボードから受信したスキャンコードを表示します。  
マウスの左ボタンを押すと終了します。  
マウスの右ボタンを押すとキーボード判別コマンド(`$47`)を送信します(動作未確認)。

MFP USART受信バッファフル割り込みを差し替えているので、動作中にIOCSレベルのキー入力は行われません。  
実行後はX680x0本体のリセットボタンによる再起動を推奨します。


## skeyset
指定したスキャンコードを引数として`IOCS _SKEYSET`を呼び出し、
その直後に`IOCS _B_KEYINP`で取得したキーデータを表示します。

