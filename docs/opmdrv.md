# OPMDRV\*.X

## md_on
> [!IMPORTANT]
> OPMDRV2.X専用です。

`OPM _MD_ON`でMIDIチャンネルを出力許可し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## md_off
> [!IMPORTANT]
> OPMDRV2.X専用です。

`OPM _MD_OFF`でMIDIチャンネルを出力禁止し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## md_stat
> [!IMPORTANT]
> OPMDRV2.X専用です。

`OPM _MD_STAT`でMIDIチャンネル出力許可・禁止状態を取得し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## m_alloc
`OPM _M_ALLOC`でトラックバッファを確保し、結果を表示します。
コマンドライン引数でトラック番号とバッファサイズ(バイト数)を指定します。


## m_antoff
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_ANTOFF`でチャンネルにオートノートオフを出力、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## m_assign
`OPM _M_ASSIGN`でチャンネルにトラック番号を割り当て、結果を表示します。
コマンドライン引数でチャンネル番号とトラック番号を指定します。


## m_atoi
`OPM _M_ATOI`でトラックバッファの先頭アドレスを取得し、結果を表示します。
コマンドライン引数でチャンネル番号(OPMDRV.X、OPMDRV2.X)、
またはトラック番号(OPMDRV3.X)を指定します。


## m_bend
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_BEND`でチャンネルのピッチベンドを設定し、結果を表示します。
コマンドライン引数でチャンネル番号とピッチベンドデータを指定します。
チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_chan
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_CHAN`で出力チャンネルを設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルの割り当てを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在の割り当てを表示します。
* 引数が2個(チャンネル番号、出力チャンネル番号) ... 割り当てを変更します。

ただし、`m_chan -1`として実行すると全チャンネルの割り当てを初期化します。


## m_chget
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM $2e`でチャンネル情報のアドレスを取得し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します。

ただし、`m_chget -1`として実行するとOPMコールの処理アドレステーブルの
アドレスを取得し、表示します。


## m_click
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_CLICK`でメトロノームのクリック音を設定、結果を表示します。
コマンドライン引数でモードまたは (ノート番号&lt;&lt;16 + ノート番号) を指定します。


## m_cont
`OPM _M_CONT`で演奏を再開し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## m_enable
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_ENABLE`でチャンネルの発声を許可・禁止し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は現在の設定を表示)。


## m_end
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_END`で演奏停止小節を設定し、結果を表示します。
コマンドライン引数で小節番号を指定します。


## m_free
`OPM _M_FREE`でトラックバッファの残りバイト数を取得し、結果を表示します。
コマンドライン引数でトラック番号を指定します。


## m_freea
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_FREEA`でトラックバッファの全バイト数を取得し、結果を表示します。


## m_ifchk
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_IFCHK`でMIDIインターフェイスの有無を検出し、結果を表示します。


## m_init
`OPM _M_INIT`でトラックバッファを初期化し、結果を表示します。
OPMDRV3.Xでは音色を初期化するモードで呼び出していますが、
なにかコマンドライン引数を指定すると音色を初期化しないモードになります。


## m_intcall
`OPM $1f`でユーザーサブルーチンの登録・停止・アドレス取得を行い、結果を表示します。

コマンドライン引数で動作が異なります。
* `m_intcall 0` ... なにも起きません(OPMDRV3.Xに機能が割り当てられていません)。
* `m_intcall -1` ... 登録情報のアドレスを取得します(`-1`は省略可)。
* `m_intcall 正数 -1` ... 登録済みのユーザーサブルーチン呼び出しを停止します(`-1`は省略可)。
* `m_intcall 正数 -k` ... ユーザーサブルーチンを登録し、常駐終了します。
  正数には割り込み間隔を指定します。

`-k`の常駐機能は、呼び出し回数を画面右上に表示する内蔵のコードを登録します
(ほかのサブルーチンを登録することはできません)。
常駐解除はできないので、実行後は再起動してください。


## m_intoff
`OPM $0e`で割り込みを停止し、結果を表示します。


## m_inton
`OPM $0d`で割り込みを開始し、結果を表示します。


## m_meas
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_MEAS`で演奏中の小節番号を取得し、結果を表示します。


## m_mstvol
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_MSTVOL`でマスターボリュームを設定・取得し、結果を表示します。
コマンドライン引数でマスターボリュームを指定します(省略時は現在の設定を表示)。


## m_mod
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_MOD`でチャンネルのモジュレーションを設定し、結果を表示します。
コマンドライン引数でチャンネル番号とモジュレーションデータを指定します。
チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_modsns
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_MODSNS`でFM音源(YM2151)のモジュレーションの深さを設定・取得し、結果を表示します。
コマンドライン引数でモジュレーションを指定します(省略時は現在の設定を表示)。


## m_opmexc
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_OPMEXC`でFM音源(YM2151)のパラメーターセットモードを設定・取得し、結果を表示します。
コマンドライン引数でモードを指定します(省略時は現在の設定を表示)。


## m_opmlfq
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_OPMLFQ`でFM音源(YM2151)の発振周波数を設定・取得し、結果を表示します。
コマンドライン引数でスピードデータを指定します(省略時は現在の設定を表示)。


## m_opmreg
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_OPMREG`でFM音源(YM2151)のレジスタを読み書きし、結果を表示します。
YM2151自体はレジスタの読み込みはできませんが、OPMDRV3.Xが内蔵している
OPMレジスタバッファにより過去に書き込んだデータが得られるようになっています。

コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全レジスタの値を一覧表示します。
  一度も書き換えられていないレジスタは`**`と表示されます。
* 引数が1個(レジスタ番号) ... レジスタの値を表示します。
  レジスタ番号に`-1`を指定すると、OPMレジスタバッファのアドレスを表示します。
* 引数が2個(レジスタ番号、書き込むデータ) ... レジスタにデータ(0-255)を書き込みます。


## m_pan
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PAN`でチャンネルのパンポットを設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのパンポットを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のパンポットを表示します。
* 引数が2個(チャンネル番号、パンポット) ... パンポットを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_panflt
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PANFLT`でパンポット設定コマンド(`Pn`、`@Pn`)の出力フィルタを設定・取得し、
結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのフィルタモードを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のフィルタモードを表示します。
* 引数が2個(チャンネル番号、フィルタモード) ... フィルタモードを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_pcmbsy
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PCMBSY`でPCMの実行状態を取得し、結果を表示します。


## m_pcmget
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PCMGET`でPCMバッファに登録されたADPCMデータを取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数が1個(ノート番号) ... バッファサイズを0バイトとしてデータサイズの取得のみ行います。
* 引数が2個(ノート番号、バッファサイズ) ... データの取得のみ行います。
* 引数が3個(ノート番号、バッファサイズ、ファイル名)
  ... データを取得し、成功した場合はファイルに保存します。

ファイルは`DOS _NEWFILE`で作成するので、すでに存在するファイルを指定した場合は
上書きされずエラーになります。


## m_pcmlen
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PCMLEN`でPCMバッファに登録されたADPCMデータのサイズを取得し、結果を表示します。
コマンドライン引数でノート番号を指定します。


## m_pcmon
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PCMON`でPCMバッファに登録されたADPCMデータを再生、結果を表示します。
コマンドライン引数でノート番号、サンプリング周波数(省略時は4 = 15.6kHz)、
音声出力モード(省略時は3 = ステレオ)を指定します。


## m_pcmrec
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PCMREC`でオーディオ入力端子からADPCMを録音し、ファイルに保存します。
コマンドライン引数でサンプリング周波数、バッファサイズ、ファイル名を指定します。

ファイルは`DOS _NEWFILE`で作成するので、すでに存在するファイルを指定した場合は
上書きされずエラーになります。


## m_pcmset
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PCMSET`でPCMバッファにPCMデータを登録し、結果を表示します。
コマンドライン引数でノート番号、サンプリング周波数、ファイル名を指定します。
コマンドライン引数をすべて省略した場合はPCMバッファをクリアします。


## m_pgmflt
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PGMFLT`でMML音色切り替えコマンド(`@n`)の出力フィルタを設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのフィルタモードを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のフィルタモードを表示します。
* 引数が2個(チャンネル番号、フィルタモード) ... フィルタモードを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_play
`OPM _M_PLAY`で演奏を開始し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## m_pnmget
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PNMGET`でPCM音源の音色名を取得し、結果を表示します。
コマンドライン引数でノート番号を指定します(省略時は全ノートの音色名を表示)。

コマンドラインの先頭で`-k`オプションを指定すると、奇数アドレスのバッファに音色名を
取得します(X68000機種ではアドレスエラーが発生します)。


## m_tnmset
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_TNMSET`でPCM音源の音色名を登録し、結果を表示します。
コマンドライン引数でノート番号と音色名を指定します。


## m_prog
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_PROG`でチャンネルの音色番号を設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルの音色番号を一覧表示します。
* 引数が1個(チャンネル番号) ... 現在の音色番号を表示します。
* 引数が2個(チャンネル番号、音色番号) ... 音色番号を設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_start
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_START`で演奏開始小節を設定し、結果を表示します。
コマンドライン引数で小節番号を指定します。


## m_stat
`OPM _M_STAT`で演奏状態を取得し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## m_stop
`OPM _M_STOP`で演奏を停止し、結果を表示します。
コマンドライン引数でチャンネル番号を指定します(省略時は全チャンネル)。


## m_sync
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_SYNC`で同期モードを設定し、結果を表示します。
コマンドライン引数で同期モードを指定します(省略時は現在の設定を表示)。

なおコマンドライン引数を省略した場合、実際にはOPMDRV3.Xの不具合で
「外部のFSKクロックに合わせて演奏」モードに変更される挙動になり、
返り値は常に0となります。


## m_sysch
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_SYSCH`でチャンネル番号の割り当てモードを変更・取得し、結果を表示します。
コマンドライン引数で割り当てモードを指定します(省略時は現在の設定を表示)。


## m_tempo
> [!IMPORTANT]
> 引数を省略する機能はOPMDRV3.X専用です。

`OPM _M_TEMPO`で曲のテンポを指定し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 現在のテンポを表示します。
* 引数が1個(テンポ) ... テンポを設定します。


## m_tnmget
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_TNMGET`でFM音源の音色名を取得し、結果を表示します。
コマンドライン引数で音色番号を指定します(省略時は全音色の音色名を表示)。

コマンドラインの先頭で`-k`オプションを指定すると、奇数アドレスのバッファに音色名を
取得します(X68000機種ではアドレスエラーが発生します)。


## m_tnmset
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_TNMSET`でFM音源の音色名を登録し、結果を表示します。
コマンドライン引数で音色番号と音色名を指定します。


## m_trk
`OPM _M_TRK`でトラックへMMLを書き込み、結果を表示します。
コマンドライン引数でトラック番号とMMLを指定します。


## m_trkget
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM $2d`でトラック情報のアドレスを取得し、結果を表示します。
コマンドライン引数でトラック番号を指定します。


## m_trns
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_TRNS`でチャンネルのトランスポーズを設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのトランスポーズを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のトランスポーズを表示します。
* 引数が2個(チャンネル番号、トランスポーズ) ... トランスポーズを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_use
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_USE`でトラックバッファの使用容量を取得し、結果を表示します。
コマンドライン引数でトラック番号を指定します(省略時は全トラックの合計使用容量を表示)。

なおXCの拡張マニュアルではトラック番号に0を指定した場合に全トラックの合計使用容量を返す
とありますが、実際には常に0が返されます。
トラック番号の省略時は`d2.l = -1`を渡すことで合計を取得しています。


## m_vget
`OPM _M_VGET`でFM音源(YM2151)の音色データを取得し、ファイルに保存します。
コマンドライン引数で音色番号とファイル名を指定します。
ファイル名を省略した場合はMML形式に変換して表示します。


## m_vel
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_VEL`でチャンネルのベロシティを設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのベロシティを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のベロシティを表示します。
* 引数が2個(チャンネル番号、ベロシティ) ... ベロシティを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_version
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_VERSION`でバージョンと作成年月日を取得し、結果を表示します。


## m_vol
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_VOL`でチャンネルのボリュームを設定・取得し、結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのボリュームを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のボリュームを表示します。
* 引数が2個(チャンネル番号、ボリューム) ... ボリュームを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_volflt
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_VOLFLT`でボリューム設定コマンド(`Vn`、`@Vn`)の出力フィルタを設定・取得し、
結果を表示します。
コマンドライン引数の数で動作が異なります。

* 引数を省略 ... 全チャンネルのフィルタモードを一覧表示します。
* 引数が1個(チャンネル番号) ... 現在のフィルタモードを表示します。
* 引数が2個(チャンネル番号、フィルタモード) ... フィルタモードを設定します。
  チャンネル番号に`-1`を指定すると全チャンネルに対し設定します。


## m_vset
ファイルから読み込んだFM音源(YM2151)の音色データを`OPM _M_VSET`で設定します。
コマンドライン引数で音色番号とファイル名を指定します。


## m_ycom
> [!IMPORTANT]
> OPMDRV3.X専用です。

`OPM _M_YCOM`でYコマンドの使用モードを設定・取得し、結果を表示します。
コマンドライン引数で使用モードを指定します(省略時は現在の設定を表示)。


## opmcallvec
> [!IMPORTANT]
> OPMDRV3.X専用です。

OPMコールの処理アドレスを表示します。
コマンドライン引数で機能番号を指定します(省略時はすべてのアドレスを表示)。


## opmdrvtype
組み込まれているOPMDRV\*.Xの種類を表示します。

OPMDRV3.Xの場合はファンクションコールで取得したバージョン番号と作成年月日も表示します。
なお組み込み時にversion 1.11と表示されるファイルは、バージョン番号は1.2となっています。

Z-MUSIC v2/v3、MEW OPM DRIVERなどの互換ドライバは組み込みなしとして扱います。

OPMDRV.XとOPMDRV2.Xをファンクションコールで判別することはできそうにないので、
`IOCS _OPMDRV`の処理ルーチンの先頭の命令を見て判別しています。
OPMDRV\*.Xや互換ドライバの種類やバージョンによっては誤判別する可能性があります。

