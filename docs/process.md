# Process

## a2arg
プログラム起動時にa2レジスタで渡されるコマンドライン引数の内容を表示します。  
HUPAIRに準拠してエンコードされた引数の場合はHUPAIRマークとARG0も表示します。

このプログラムにはHUPAIRマークを埋め込んであるため、親プロセスがHUPAIR
準拠であればコマンドライン引数もHUPAIRに従ってエンコードされるはずです。


## a2arg_nh
プログラム起動時にa2レジスタで渡されるコマンドライン引数の内容を表示します。  
HUPAIRに準拠してエンコードされた引数の場合はHUPAIRマークとARG0も表示します。

このプログラムにはHUPAIRマークは埋め込まれていません。


### bindno
`DOS _EXEC (MD=5;bindno)`でオーバーレイXファイルのモジュール番号を取得し、結果を表示します。  
一つ目のコマンドライン引数でオーバーレイXファイルのファイル名を、
二つ目の引数でモジュールのファイル名を指定します。

Human68k内部で引数で指定したモジュールのファイル名の拡張子の1バイト目が`X`に変更されるため、
以下の挙動になります。
* モジュールの拡張子`.X`は省略できます。
* 拡張子の1バイト目が`X`以外のモジュールを取得できません。
* TwentyOne +Cのとき拡張子が小文字の`x`のモジュールを取得できません。

使用例: `bindno COMMAND.X COMMANDO.x`


## crampedexec
空きメモリ容量を指定したサイズに制限してファイルを実行します。

一つ目のコマンドライン引数で空きメモリ容量を指定します。
これには実行するプロセスのメモリ管理ポインタ、PSPの容量は含みません。  
数値の後にバイト数の単位を指定することができます。
* (省略) ... バイト単位
* `k` ... キロバイト単位
* `m` ... メガバイト単位

二つ目以降のコマンドライン引数で実行ファイルとその引数を指定します。

空きメモリ空間が分断されている場合は、指定通りに空きメモリ容量が制限されない場合があります。


## dumpenv
環境変数をすべて表示します。  
なにかコマンドライン引数を指定すると終了時にキー入力を待ち、
終了コード1を返します(CONFIG.SYSの`EXCONFIG =`行から実行する場合用)。


## dumpstupreg
起動時のMPUレジスタの値を表示します。

* データレジスタ(d0～d7) ... Human68kの仕様として不定な値になります。
* アドレスレジスタ(a0～a7) ... a5～a6はHuman68kの仕様として不定な値になります。
* スーパーバイザスタックポインタ(ssp) ... `DOS _SUPER_JSR`でサブルーチンを
  呼び出してsspを取得しています。各種情報がスタックに積まれている分、
  起動時のsspより小さい値が表示されます。
* srまたはccr ... MPUが68000の場合はsr、68010以上の場合はccrを表示します。


## entryceil
上位メモリから起動して「OK.」と表示するだけのプログラムで、
HUPAIR準拠表示の判別を行うコードの動作テスト用です。

Human68kの非公開機能を使って上位メモリにロードさせます。  
そのためのフラグをHLKXの`-g2`オプションで設定するので、
リンカとしてHLKXを使う必要があります。

RAMDISKなど上位メモリを使用するドライバは組み込まずに起動し、
HUPAIRに対応したシェルなどからentryceilを実行します
(スーパーバイザモードで動作するシェルの場合はメインメモリ実装量を11MB以下にしておきます)。  
子プロセスのメモリブロック範囲外を参照する判別コードの場合、
未実装メモリを参照してバスエラーが発生します。


## execas
「ファイルを別名で実行するR形式実行ファイル」を作成します
(作成にはシェルのリダイレクト機能を用います)。
```
execas 実行ファイル名 > 新ファイル名.r
```
実行ファイルは(通常であればカレントディレクトリと)環境変数`path`からの検索が行われ、
絶対パス名に正規化されて新ファイルに埋め込まれます。

指定する実行ファイルはHUPAIRに対応している必要があります。

作成されたファイルを実行すると、作成時に指定された実行ファイルをロードし、
そのプロセスのPSP内に新ファイルのパス名とファイル名を上書きしてから実行します。

たとえば`execas C:\dir\gzip.x > D:\folder\gunzip.r`として作成されたgunzip.rを実行すると、
gunzip.rから実行された`C:\dir\gzip.x`からは自分自身が`D:\folder\gunzip.r`
というファイル名であるかのように見えます。


## keepceil
上位メモリに常駐するだけのプログラムで、常駐プロセスの常駐検査を行うコードの動作テスト用です。

Human68kの非公開機能を使って上位メモリにロードさせます。  
そのためのフラグをHLKXの`-g2`オプションで設定するので、
リンカとしてHLKXを使う必要があります。

メインメモリ実装量を11MB以下にし、RAMDISKなど上位メモリを使用するドライバは組み込まずに起動し、
keepceilを常駐してから常駐検査コードを実行します。  
常駐プロセスのメモリブロック範囲外を参照する検査コードの場合、未実装メモリを参照してバスエラーが発生します
(ただしkeepceilの本体が16バイトあるので、その範囲内しか見ない検査コードであれば問題を検出できません)。


## keepcmem
上位メモリからメモリブロックを確保して常駐するだけのプログラムで、常駐プロセスの常駐検査を行う
コードの動作テスト用です。

既定ではプロセス本体とメモリブロックは最低サイズ(0バイト)ですが、
なにかコマンドライン引数を指定するとそれぞれ16バイトとします。


## lineage
自分自身と親および祖先のプロセスをさかのぼり、メモリ管理ポインタの内容を表示します。
常駐終了しているプロセスは親のメモリブロックを辿ることができないため、それ以上
さかのぼりません(バックグラウンドタスクで実行した場合に該当します)。


## loadonly
コマンドライン引数で指定した実行ファイルを`DOS _EXEC (MD=3;loadonly)`でロードし、
結果を表示します。
ロードされたコードは実行されず、単にロードだけが行われます。


## mallocall
プロセス自身のメモリブロックのアドレスとサイズを表示したあと、
可能な限りメモリブロックを確保してそのアドレスとサイズを表示します。  
コマンドライン引数で動作モードを指定できます。  
- `s` ... プロセスのメモリブロックを最小まで縮小します。
- `e` ... プロセスのメモリブロックを最大まで拡大します。
- `2` ... `DOS _SETBLOCK`の代わりに`DOS _SETBLOCK2`を使います(要060turbo.sys)。
- `3` ... `DOS _MALLOC`の代わりに`DOS _MALLOC3`を使います(要060turbo.sys)。


## malloc_ba_exec
`DOS _MALLOC`でメモリブロックを確保し結果(アドレス)を表示し解放、
コマンドライン引数で指定したコマンドを`DOS _EXEC`で実行し結果を表示、
再度メモリブロックを確保し結果を表示し解放、という操作を行います。


## openkeep
コマンドライン引数で指定したファイルを読み込み専用でオープンし、常駐終了(`DOS _KEEPPR`)します。  
XCのプログラマーズマニュアルには「オープンしているファイルハンドルはクローズします」
と記載されていますが、実際にはクローズされません。

ファイルをクローズする方法は用意していないので、実行後は再起動してください。


## pathchk
コマンドライン引数で指定したファイルを`DOS _EXEC (MD=2;pathchk)`で調べ、結果を表示します。


## sysstack_exec
独自に確保したシステムスタック(32KiB)をスーパーバイザスタックポインタ(`ssp`)に設定してから、
コマンドライン引数で指定したコマンドを`DOS _EXEC`で実行し結果を表示します。

