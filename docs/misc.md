# Miscellaneous

## datetime
現在の日時をIOCSで取得し、BCD形式と文字列形式で表示します。  
文字列形式については`IOCS _DATEASC`にある4種類がそれぞれ表示されます。


## dbrams
IOCSワーク`$cb8`、`$cba`の値を再計測します。  
MPU 68000、IOCS ROM version 1.1、1.2、1.3、1.6(XEiJ)専用です。


## exception
コマンドライン引数で指定した例外を発生させ、例外処理を呼び出します。  

`-p`オプションを指定すると、スタックに例外発生時と同じデータを積んでから
例外処理ハンドラにジャンプすることにより、擬似的に例外を発生させます。
この機能はMPUが68000でなければ使えません。

コマンドライン引数で例外を指定します。
* illegal ... 不当命令
* aline ... A系列未実装命令
* trap#0 ... `trap #0`
* spurious ... スプリアス割り込み(※`-p`専用です)


## joyget
`IOCS _JOYGET`によるジョイスティック入力を行い、入力状態を表示します。  
キーを押すと終了します。


## midi_reg
MIDIボード(#1 = $00eafa00-$00eafa0f)のYM3802のレジスタの値を表示します(読み込みレジスタのみ)。  
YM3802はレジスタへのアクセス手順が分かりにくかったので、その確認用です。


## reset68k
`trap #10`命令によるソフトウェアリセットを行います。

X680x0のネタとして`NJ`の2文字をR形式実行ファイルにするとソフトウェアリセットができるという話がありますが、
プロセス起動直後のd0レジスタの内容は不定なので厳密に言うと確実ではありません
(`pxNJ`などであれば問題ありません)。
このプログラムではd0レジスタに`'X68k'`を入れて`trap #10`を実行します。

COMMAND.Xで下記のコマンドを実行すると同一内容の実行ファイルを作成できます。
```
echo \L\L $NJX68k>reset68k.r
```


## rtc_reg
RTC(RP5C15)のレジスタの値を表示します。


## runwaitchk
メモリを読み込むループの実行時間を計測します。厳密な計測ではないので目安です。  
実行コードがメインメモリ上にある場合とGVRAM上にある場合、読み込みアドレスがメインメモリの場合と
GVRAMの場合、それぞれの組み合わせで合計4通りを計測します。


## super_time
`IOCS _B_SUPER`、`DOS _SUPER`、`DOS _SUPER_JSR`の実行時間を計測します。
厳密な計測ではないので目安です。


## sysport
システムポート領域($00e8e000-$00e8e00f、ポート未割り当てのアドレスも含む)
を読み込んで値を表示します。


## tokikoe
テキスト画面に特定のメッセージを描画します。  
なにかコマンドライン引数を指定すると表示が改善されます。


## trap15trace
IOCSコールの割り込み処理である`trap #15`の処理ルーチンを差し替えて常駐終了します。

差し替えたルーチンにはDOSコールやFEFUNCと同様のトレース実行を考慮した処理が追加されており、
通常はデバッガで`trap #15`命令をトレース実行するとプログラムが停止せず続行しますが、
このプログラムを常駐するとトレースで停止するようになります。

ただし、追加処理の分だけ処理速度が遅くなります。
IOCSコールがトレース非対応なのは、呼び出される回数が多いため処理速度への影響を考慮した
のかもしれません。

常駐解除はできないので、実行後は再起動してください。

> [!WARNING]
> 実験用に用意したシステムでのみ実行してください。  
> ※普段使っているシステムでは実行しないこと！


## vdispst_time
`IOCS _VDISPST`で設定した割り込みが発生するまでの時間を計測して表示します(100分の1秒単位)。  
コマンドライン引数で動作モードを指定できます。
- `0`～`255` ... カウンター値の指定(無指定時は`1`)。
- `a` ... IOCSコールの不具合を回避します。

